<!DOCTYPE html>
<html>
<head>
    <title>Gemini Chat Room</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!-- 引入“饼干体”网络字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

    <style>
        /* --- 主题变量定义 --- */
        
        /* 默认主题：“主题一” */
        :root {
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --accent-color: #0084ff;
            --text-color: #0d0d0d;
            --secondary-text: #65676b;
            --border-color: #ced0d4;
            --my-message-bg: #0084ff;
            --their-message-bg: #e4e6eb;
            --bg-image: none; /* 主题一没有背景图 */
            --display-font: 'ZCOOL KuaiLe', cursive;
        }

        /* 猫咪主题：“陌上悠桐（庆生版）” */
        body[data-theme='cat-theme'] {
            --bg-color: #fff0f5; /* 淡粉色背景 */
            --panel-bg: rgba(255, 255, 255, 0.85); /* 半透明白色面板 */
            --accent-color: #ff69b4; /* 亮粉色主题色 */
            --text-color: #333;
            --secondary-text: #6a5acd; /* 蓝紫色次要文字 */
            --border-color: #ffb6c1; /* 浅粉色边框 */
            --my-message-bg: #ff69b4;
            --their-message-bg: #ffffff;
            --bg-image: url('https://www.transparenttextures.com/patterns/cat-footprint.png'); /* 猫爪背景图 */
        }
        
        /* --- 基础样式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: var(--bg-color);
            background-image: var(--bg-image); /* 应用背景图 */
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        #chat-container { display: flex; width: 100%; height: 100%; transition: all 0.3s ease; }

        #sidebar {
            width: 280px;
            background-color: var(--panel-bg);
            backdrop-filter: blur(5px); /* 毛玻璃效果，在半透明时更美观 */
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        #sidebar h2 {
            margin: 0 0 20px 0;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        #user-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1; /* 修复用户列表显示不全的bug */
        }
        #user-list li { padding: 10px; border-radius: 8px; margin-bottom: 5px; color: var(--secondary-text); font-weight: 500; }

        /* --- 主题切换按钮 --- */
        #theme-switcher {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }
        
        /* --- 聊天主窗口 --- */
        #main-chat {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: transparent; /* 改为透明以显示背景文字 */
            position: relative; /* 成为背景文字的定位父元素 */
        }
        
        /* --- 生日快乐背景文字 --- */
        body[data-theme='cat-theme'] #main-chat::before {
            content: '小陌陌生日快乐';
            font-family: var(--display-font);
            font-size: 8vw; /* 字体大小随屏幕宽度变化 */
            color: rgba(255, 105, 180, 0.15); /* 半透明的粉色 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0; /* 置于底层 */
            pointer-events: none; /* 让文字不影响鼠标点击 */
        }
        
        #messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            list-style-type: none;
            margin: 0;
            position: relative; /* 确保消息在背景文字之上 */
            z-index: 1;
        }
        /* ... (消息 li 样式保持不变) ... */
        #messages li { padding: 10px 15px; border-radius: 18px; margin-bottom: 10px; max-width: 70%; line-height: 1.4; opacity: 0; transform: translateY(20px); animation: slideUp 0.3s forwards; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        #messages li.my-message { background-color: var(--my-message-bg); color: white; margin-left: auto; text-align: right; }
        #messages li.their-message { background-color: var(--their-message-bg); color: var(--text-color); margin-right: auto; }
        #messages li.system-message { background: none; box-shadow: none; color: var(--secondary-text); font-style: italic; font-size: 0.9em; text-align: center; width: 100%; max-width: 100%; }
        .message-sender { font-weight: bold; display: block; margin-bottom: 4px; font-size: 0.9em; color: var(--secondary-text); }
        .my-message .message-sender { display: none; }
        
        #form { display: flex; padding: 20px; border-top: 1px solid var(--border-color); background-color: var(--panel-bg); backdrop-filter: blur(5px); }
        #input { border: 1px solid var(--border-color); background-color: var(--their-message-bg); padding: 10px 15px; flex-grow: 1; border-radius: 18px; margin-right: 10px; font-size: 1em; color: var(--text-color); }
        #input:focus { outline: none; border-color: var(--accent-color); }
        #form button { background: var(--accent-color); border: none; padding: 10px 20px; color: white; border-radius: 18px; cursor: pointer; font-size: 1em; }
        
        /* ... (登录框样式保持不变) ... */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 100; }
        #login-box { background: var(--panel-bg); padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        #login-box input { padding: 12px; font-size: 1.1em; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; }
        #login-box button { padding: 12px 25px; font-size: 1.1em; background: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer; }

        /* ... (移动端响应式样式保持不变) ... */
        @media (max-width: 768px) { #sidebar { position: fixed; left: 0; top: 0; height: 100%; z-index: 10; margin-left: -280px; } body.sidebar-open #sidebar { margin-left: 0; } body.sidebar-open #main-chat{ margin-left: 280px; } #toggle-users { display: block; position: fixed; top: 15px; left: 15px; z-index: 20; background: var(--accent-color); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; } }
        @media (min-width: 769px) { #toggle-users { display: none; } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-box">
            <h2>Enter your nickname</h2>
            <form id="login-form">
                <input id="nickname-input" autocomplete="off" required /><br/>
                <button>Join Chat</button>
            </form>
        </div>
    </div>

    <div id="chat-container">
        <div id="sidebar">
            <h2>Online Users</h2>
            <ul id="user-list"></ul>
            <!-- 1. 添加主题切换按钮 -->
            <div id="theme-switcher">切换到 陌上悠桐（庆生版）</div>
        </div>

        <div id="main-chat">
            <ul id="messages"></ul>
            <form id="form" action="">
                <input id="input" autocomplete="off" placeholder="Type a message..." /><button>Send</button>
            </form>
        </div>
    </div>

    <button id="toggle-users">&#9776;</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // --- 保持原有的聊天逻辑不变 ---
        const socket = io();
        const loginForm = document.getElementById('login-form');
        const nicknameInput = document.getElementById('nickname-input');
        const loginOverlay = document.getElementById('login-overlay');
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        const userList = document.getElementById('user-list');
        const toggleButton = document.getElementById('toggle-users');
        let myNickname = '';
        loginForm.addEventListener('submit', (e) => { e.preventDefault(); if (nicknameInput.value) { myNickname = nicknameInput.value; socket.emit('new user', myNickname); loginOverlay.style.display = 'none'; input.focus(); } });
        form.addEventListener('submit', (e) => { e.preventDefault(); if (input.value) { socket.emit('chat message', input.value); input.value = ''; } });
        socket.on('chat message', (data) => { const item = document.createElement('li'); const sender = document.createElement('span'); sender.className = 'message-sender'; sender.textContent = data.username; item.textContent = data.msg; item.prepend(sender); if (data.username === myNickname) { item.classList.add('my-message'); } else { item.classList.add('their-message'); } messages.appendChild(item); messages.scrollTop = messages.scrollHeight; });
        const showSystemMessage = (msg) => { const item = document.createElement('li'); item.textContent = msg; item.classList.add('system-message'); messages.appendChild(item); messages.scrollTop = messages.scrollHeight; };
        socket.on('user joined', (username) => { showSystemMessage(`${username} has joined the chat.`); });
        socket.on('user left', (username) => { if(username) showSystemMessage(`${username} has left the chat.`); });
        socket.on('update user list', (users) => { userList.innerHTML = ''; users.forEach(user => { const item = document.createElement('li'); item.textContent = user; if (user === myNickname) { item.textContent += ' (You)'; item.style.fontWeight = 'bold'; } userList.appendChild(item); }); });
        toggleButton.addEventListener('click', () => { document.body.classList.toggle('sidebar-open'); });
        
        // --- 2. 新增：主题切换的逻辑 ---
        const themeSwitcher = document.getElementById('theme-switcher');
        const themeOneName = "主题一";
        const catThemeName = "陌上悠桐（庆生版）";

        // 功能：应用指定的主题
        function applyTheme(theme) {
            if (theme === 'cat-theme') {
                document.body.dataset.theme = 'cat-theme';
                themeSwitcher.textContent = `切换到 ${themeOneName}`;
                localStorage.setItem('chat_theme', 'cat-theme');
            } else {
                document.body.dataset.theme = 'theme-one';
                themeSwitcher.textContent = `切换到 ${catThemeName}`;
                localStorage.setItem('chat_theme', 'theme-one');
            }
        }

        // 按钮点击事件
        themeSwitcher.addEventListener('click', () => {
            const currentTheme = document.body.dataset.theme;
            if (currentTheme === 'cat-theme') {
                applyTheme('theme-one');
            } else {
                applyTheme('cat-theme');
            }
        });

        // 页面加载时，检查并应用保存过的主题
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('chat_theme') || 'theme-one';
            applyTheme(savedTheme);
        });

    </script>
</body>
</html>
